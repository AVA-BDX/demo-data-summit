version: "2.0"

rules:
- rule: start note_asking_form and store times for both user question and bot answer
  steps:
  - intent: faq
  - action: action_store_all_bot_responses
  - action: action_get_user_curent_intent
  - action: user_note_to_none
  - action: action_user_last_message
  - action: utter_faq
  - action: action_bot_last_message
  - action: action_bot_utterances_list
  - action: note_asking_form
  - active_loop: note_asking_form

- rule: go back to another faq when the user ask so
  condition:
  - active_loop: note_asking_form
  steps:
  - intent: faq
  - action: action_store_all_bot_responses
  - action: action_get_user_curent_intent
  - action: user_note_to_none
  - action: action_user_last_message
  - action: utter_faq
  - action: action_bot_last_message
  - action: action_bot_utterances_list
  - action: note_asking_form
  - active_loop: note_asking_form

- rule: submit the note_asking_form
  condition:
      - active_loop: note_asking_form
  steps:
    - action: note_asking_form
    - active_loop: null
    - action: action_record_the_user_note

- rule: the bot reformulate any time the user ask him to reformulate
  condition:
  - active_loop: note_asking_form
  steps:
  - action: note_asking_form
  - active_loop: note_asking_form
  - intent: deny
  - action: utter_reformulate


- rule: happy path, ask the user if he still want a response, user affirm
  steps:
  - action: action_utter_reformulate
  - action: action_bot_utterances_list
  - intent: affirm
  - action: action_no_further_reformulation


- rule: unhapppy path, ask the user if he still want a response, he deny
  steps:
  - action: action_utter_reformulate
  - action: action_bot_utterances_list
  - intent: deny
  - action: utter_ask_another_question




- rule: bot ask to reformulate if the user deny after a faq
  steps:
  - intent: ask_reformulate
  - action: action_utter_reformulate
  - action: action_bot_utterances_list


- rule: The chatbot says it does not understand when it doesn't understand
  steps:
  - intent: nlu_fallback
  - action: utter_dont_understand



# - rule: store bot responses in a slot at the begening of a conversation
#   conversation_start: false
#   steps:
#   - action: action_session_start
#   - action: action_store_all_bot_responses